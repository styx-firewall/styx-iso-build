
# Deshabilitar instalación del kernel estándar
d-i base-installer/kernel/image string none

# Configuración de usuario
#d-i passwd/root-login boolean false
#d-i passwd/make-user boolean true
d-i passwd/make-user boolean false
d-i passwd/allow-badname boolean true
d-i user-setup/allow-password-weak boolean true
d-i passwd/user-fullname string admin
#d-i passwd/username string admin
#d-i passwd/user-password password admin
#d-i passwd/user-password-again password admin
#d-i user-setup/encrypt-home boolean false

# Particionamiento
d-i partman-auto/method string regular
d-i partman-auto/choose_recipe select atomic
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

# Configuracion discos
d-i partman-auto/disk string /dev/sda
#d-i partman-auto/method string lvm

# Mirror
d-i mirror/country string automatic
d-i mirror/http/proxy string
d-i mirror/protocol string http
d-i mirror/http/hostname string deb.debian.org
d-i mirror/http/directory string /debian
d-i apt-setup/security_host string security.debian.org
d-i apt-setup/security_path string /debian-security

## Survey false
d-i popularity-contest/participate boolean false

# Configuración de red
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string styx
d-i netcfg/get_domain string styx.local
# Nombres ethernet tradicionales
#d-i debian-installer/add-kernel-opts string net.ifnames=0 biosdevname=0

# Incluir nuestro kernel personalizado (ya agregado a pool/extras)
d-i apt-setup/local0/repository string file:/cdrom/ dists/stable/extras/binary-amd64/
d-i apt-setup/local0/comment string Custom packages
d-i pkgsel/include string curl linux-image-styx styx-conf nftables net-tools vlan \
    ifenslave bridge-utils ulogd2 ulogd2-json ulogd2-pcap python3-pam openssh-server \
    openssh-client udhcpc

## No instalar paquetes recomendados
tasksel tasksel/first multiselect
d-i pkgsel/install-recommends boolean false
d-i pkgsel/install-language-support boolean false

# No actualizar paquetes
#d-i pkgsel/update-policy select none
#d-i pkgsel/upgrade select none

# Instala GRUB automáticamente en /dev/sda
d-i grub-installer/bootdev string /dev/sda
d-i grub-installer/only_debian boolean true
d-i grub-installer/confirm boolean true
d-i grub-installer/with_other_os boolean false

# Evitar instalar GRUB
# d-i grub-installer/skip boolean true

# Late commands
# update-initramfs para el kernel personalizado no vale -k all
d-i preseed/late_command string \
    cp /cdrom/styx-postinst.sh /target/ ; \
    in-target sed -i '/cdrom:/d' /etc/apt/sources.list ; \
    int-target apt update ; \
    in-target apt-get install initramfs-tools -y ; \
    in-target update-initramfs -u -k 6.12.42-13-styx ; \
    in-target update-grub ;\
    in-target bash /styx-postinst.sh ; \
    in-target rm /styx-postinst.sh

# Finalizar
#d-i finish-install/reboot_in_progress note
#d-i debian-installer/exit/poweroff boolean true